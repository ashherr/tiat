<!DOCTYPE html>
<html>
<head>
    <title>The Intersection of Art & Technology</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Kosugi&display=swap" rel="stylesheet">
    <style>
        body { 
            font-family: 'Kosugi', sans-serif; 
            margin: 20px;
            font-size: 14px; 
        }
        h1 { 
            font-size: 26px; 
            margin-top: 30px;
        }
        h2 {
            font-size: 14px;
            font-weight: normal;
            margin-top: 5px;
            margin-bottom: 5px;
        }
        .salon-link {
            display: block;
            font-size: 14px;
            margin-bottom: 20px;
        }
        .submit-button {
            margin-top: 20px;
            margin-bottom: 30px;
            font-size: 12px;
        }
        .event { 
            margin-left: 20px; 
            cursor: pointer; 
            font-size: 13px;
            text-decoration: none;
            color: black;
            display: block;
            padding: 2px 0;
        }
        .event:hover {
            background-color: #f5f5f5;
        }
        .date { 
            font-weight: bold; 
            font-size: 14px; 
            margin-top: 20px;
            margin-bottom: 5px;
        }
        /* Add extra space before the first date */
        .date:first-of-type {
            margin-top: 10px;
        }
        .preview { 
            position: fixed; 
            top: 50%; 
            left: 50%; 
            transform: translate(-50%, -50%); 
            display: none; 
            text-align: center;
            font-size: 12px; 
            background-color: white;
            padding: 10px;
            border: 1px solid #ccc;
            z-index: 100;
        }
        .preview img { max-width: 500px; max-height: 400px; }
        .tags { 
            margin-bottom: 20px; 
            display: flex; 
            align-items: center; 
            padding-bottom: 20px;
        }
        .filter-label { margin-right: 10px; font-size: 12px; }
        .tag { 
            cursor: pointer; 
            margin-right: 10px; 
            text-decoration: underline; 
            font-size: 12px; 
            padding: 2px 5px;
        }
        .tag-active {
            background-color: #f0f0f0;
            font-weight: bold;
        }
        .star { color: gold; }
    </style>
</head>
<body>
    <h1>the intersection of art & technology</h1>
    <h2>every bay area art + technology event</h2>
    <a href="{{ url_for('salons') }}" class="salon-link">tiat salons</a>

    <div class="tags">
        <span class="filter-label">filter:</span>
        <span class="tag tag-active" id="tag-all" onclick="filterByTag(null)">all</span>
        {% for tag in ['generative', 'hardware', 'internet', 'projection', 'installation', 'XR', 'sound', 'AI / ML', 'speculative', 'data', 'fabrication'] %}
            <span class="tag" id="tag-{{ tag|lower|replace(' / ', '-')|replace(' ', '-') }}" onclick="filterByTag('{{ tag }}')">{{ tag }}</span>
        {% endfor %}
    </div>
    
    <div class="submit-button">
        <a href="{{ url_for('submit_event') }}">Submit New Event</a>
    </div>

    <div id="events"></div>
    <div id="preview" class="preview"></div>

    <script>
        function loadEvents(tag = null) {
            let url = '/api/events';
            if (tag) {
                url += `?tag=${tag}`;
            }
            fetch(url)
                .then(response => response.json())
                .then(events => {
                    const eventsDiv = document.getElementById('events');
                    eventsDiv.innerHTML = '';
                    let currentDate = null;
                    
                    events.forEach(event => {
                        const date = new Date(event.start_time).toLocaleDateString();
                        if (date !== currentDate) {
                            currentDate = date;
                            const dateDiv = document.createElement('div');
                            dateDiv.className = 'date';
                            dateDiv.textContent = date;
                            eventsDiv.appendChild(dateDiv);
                        }
                        
                        const eventLink = document.createElement('a');
                        eventLink.className = 'event';
                        eventLink.href = event.event_link;
                        eventLink.target = "_blank";
                        eventLink.innerHTML = `
                            ${event.is_starred ? '<span class="star">â˜…</span>' : ''}
                            ${new Date(event.start_time).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})} - ${event.title} - ${event.location}
                        `;
                        
                        eventLink.onmouseover = () => {
                            const preview = document.getElementById('preview');
                            preview.innerHTML = `
                                <img src="${event.image_url}" alt="${event.title}">
                                <p>${event.description}</p>
                            `;
                            preview.style.display = 'block';
                        };
                        
                        eventLink.onmouseout = () => {
                            document.getElementById('preview').style.display = 'none';
                        };
                        
                        eventsDiv.appendChild(eventLink);
                    });
                });
        }

        function filterByTag(tag) {
            // Remove active class from all tags
            document.querySelectorAll('.tag').forEach(el => {
                el.classList.remove('tag-active');
            });
            
            // Add active class to selected tag
            if (tag === null) {
                document.getElementById('tag-all').classList.add('tag-active');
            } else {
                // Convert tag to the same format as the id
                const tagId = 'tag-' + tag.toLowerCase().replace(' / ', '-').replace(' ', '-');
                document.getElementById(tagId).classList.add('tag-active');
            }
            
            loadEvents(tag);
        }

        // Load events when page loads
        document.addEventListener('DOMContentLoaded', function() {
            loadEvents();
        });
    </script>
</body>
</html> 