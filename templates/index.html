<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Intersection of Art & Technology</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Kosugi&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='responsive.css') }}">
    <style>
        body { 
            font-family: 'Kosugi', sans-serif; 
            margin: 20px;
            font-size: 14px; 
        }
        h1 { 
            font-size: 26px; 
            margin-top: 30px;
        }
        h2 {
            font-size: 14px;
            font-weight: normal;
            margin-top: 5px;
            margin-bottom: 5px;
        }
        .salon-link {
            display: block;
            font-size: 14px;
            margin-bottom: 20px;
        }
        .submit-button {
            margin-top: 20px;
            margin-bottom: 30px;
            font-size: 12px;
        }
        .event { 
            margin-left: 20px; 
            cursor: pointer; 
            font-size: 13px;
            text-decoration: none;
            color: black;
            display: block;
            padding: 2px 0;
        }
        .event:hover {
            background-color: #f5f5f5;
        }
        .date { 
            font-weight: bold; 
            font-size: 14px; 
            margin-top: 20px;
            margin-bottom: 5px;
        }
        /* Add extra space before the first date */
        .date:first-of-type {
            margin-top: 10px;
        }
        .preview { 
            position: fixed; 
            top: 50%; 
            left: 50%; 
            transform: translate(-50%, -50%); 
            display: none; 
            text-align: center;
            font-size: 12px; 
            background-color: white;
            padding: 10px;
            border: 1px solid #ccc;
            z-index: 100;
        }
        .preview img { max-width: 500px; max-height: 400px; }
        .tags { 
            margin-bottom: 20px; 
            display: flex; 
            align-items: center; 
            padding-bottom: 20px;
        }
        .filter-label { margin-right: 10px; font-size: 12px; }
        .tag { 
            cursor: pointer; 
            margin-right: 10px; 
            text-decoration: underline; 
            font-size: 12px; 
            padding: 2px 5px;
        }
        .tag-active {
            background-color: #f0f0f0;
            font-weight: bold;
        }
        .star { color: gold; }
    </style>
</head>
<body>
    <h1>the intersection of art & technology</h1>
    <h2>every bay area art + technology event</h2>
    <br>
    <a href="{{ url_for('salons') }}" class="salon-link">tiat salons</a>

    <div class="tags">
        <span class="filter-label">filter:</span>
        <span class="tag tag-active" id="tag-all" onclick="filterByTag(null)">all</span>
        {% for tag in ['generative', 'hardware', 'internet', 'projection', 'installation', 'XR', 'sound', 'AI / ML', 'speculative', 'data', 'fabrication'] %}
            <span class="tag" id="tag-{{ tag|lower|replace(' / ', '-')|replace(' ', '-') }}" onclick="filterByTag('{{ tag }}')">{{ tag }}</span>
        {% endfor %}
    </div>
    
    <div class="submit-button">
        <a href="{{ url_for('submit_event') }}">Submit New Event</a>
    </div>

    <div id="events"></div>
    <div id="preview" class="preview"></div>

    <script>
        // Check if it's a touch device
        const isTouchDevice = () => {
            return ('ontouchstart' in window) || (navigator.maxTouchPoints > 0);
        };
        
        function loadEvents(tag = null) {
            let url = '/api/events';
            if (tag) {
                url += `?tag=${tag}`;
            }
            fetch(url)
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    return response.json();
                })
                .then(events => {
                    // Make sure events is always an array
                    if (!Array.isArray(events)) {
                        console.error('API response is not an array:', events);
                        events = [];
                    }
                    
                    const eventsDiv = document.getElementById('events');
                    eventsDiv.innerHTML = '';
                    
                    // Show message if no events
                    if (events.length === 0) {
                        const noEventsMsg = document.createElement('p');
                        noEventsMsg.textContent = tag ? `No upcoming events with tag "${tag}"` : 'No upcoming events';
                        noEventsMsg.style.marginLeft = '20px';
                        eventsDiv.appendChild(noEventsMsg);
                        return;
                    }
                    
                    let currentDate = null;
                    
                    events.forEach(event => {
                        const date = new Date(event.start_time).toLocaleDateString();
                        if (date !== currentDate) {
                            currentDate = date;
                            const dateDiv = document.createElement('div');
                            dateDiv.className = 'date';
                            dateDiv.textContent = date;
                            eventsDiv.appendChild(dateDiv);
                        }
                        
                        const eventLink = document.createElement('a');
                        eventLink.className = 'event';
                        eventLink.href = event.event_link;
                        eventLink.target = "_blank";
                        eventLink.innerHTML = `
                            ${event.is_starred ? '<span class="star">â˜…</span>' : ''}
                            ${new Date(event.start_time).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})} - ${event.title} - ${event.location}
                        `;
                        
                        if (isTouchDevice()) {
                            // For touch devices, show preview on click/tap
                            eventLink.addEventListener('click', function(e) {
                                // Only show preview if not already shown
                                const preview = document.getElementById('preview');
                                if (preview.style.display !== 'block') {
                                    e.preventDefault(); // Prevent following the link first time
                                    
                                    // Hide any previously shown previews
                                    preview.classList.add('preview-active');
                                    preview.innerHTML = `
                                        <img src="${event.image_url}" alt="${event.title}">
                                        <p>${event.description}</p>
                                        <p>Tap again to visit event page</p>
                                    `;
                                    preview.style.display = 'block';
                                    
                                    // Add click event to dismiss preview
                                    document.addEventListener('click', function dismissPreview(e) {
                                        if (!preview.contains(e.target) && e.target !== eventLink) {
                                            preview.style.display = 'none';
                                            document.removeEventListener('click', dismissPreview);
                                        }
                                    });
                                }
                            });
                        } else {
                            // For non-touch devices, use hover as before
                            eventLink.onmouseover = () => {
                                const preview = document.getElementById('preview');
                                preview.innerHTML = `
                                    <img src="${event.image_url}" alt="${event.title}">
                                    <p>${event.description}</p>
                                `;
                                preview.style.display = 'block';
                            };
                            
                            eventLink.onmouseout = () => {
                                document.getElementById('preview').style.display = 'none';
                            };
                        }
                        
                        eventsDiv.appendChild(eventLink);
                    });
                })
                .catch(error => {
                    console.error('Error fetching events:', error);
                    const eventsDiv = document.getElementById('events');
                    eventsDiv.innerHTML = `<p style="margin-left: 20px">Error loading events: ${error.message}</p>`;
                });
        }

        function filterByTag(tag) {
            // Remove active class from all tags
            document.querySelectorAll('.tag').forEach(el => {
                el.classList.remove('tag-active');
            });
            
            // Add active class to selected tag
            if (tag === null) {
                document.getElementById('tag-all').classList.add('tag-active');
            } else {
                // Convert tag to the same format as the id
                const tagId = 'tag-' + tag.toLowerCase().replace(' / ', '-').replace(' ', '-');
                document.getElementById(tagId).classList.add('tag-active');
            }
            
            loadEvents(tag);
        }

        // Load events when page loads
        document.addEventListener('DOMContentLoaded', function() {
            loadEvents();
        });
    </script>
</body>
</html> 