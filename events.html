<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>events | the intersection of art & technology</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Kosugi&display=swap" rel="stylesheet">
    <!-- Supabase JS Library -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
      body {
        font-family: 'Kosugi', sans-serif;
        margin: 20px;
        line-height: 1.6;
        font-size: 14px;
      }
      h1 {
        font-size: 18px;
      }
      h2 {
        font-size: 16px;
      }
      .date {
        font-weight: bold;
        margin-top: 20px;
        font-size: 14px;
      }
      .event {
        margin-left: 20px;
        cursor: pointer;
        font-size: 14px;
      }
      .event-image {
        display: none;
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        max-width: 80%;
        max-height: 80%;
        z-index: 1;
      }
      .event-description {
        display: none;
        position: fixed;
        bottom: 10%;
        left: 50%;
        transform: translateX(-50%);
        background: white;
        padding: 10px;
        max-width: 80%;
        z-index: 2;
      }
      .tag {
        display: inline-block;
        margin-right: 10px;
        cursor: pointer;
        font-size: 13px;
      }
      .tag.active {
        text-decoration: underline;
      }
      .loading {
        text-align: center;
        margin: 20px 0;
      }
      .error {
        color: red;
        margin: 20px 0;
      }
      #submission-form {
        margin-top: 20px;
        padding: 20px;
        border: 1px solid #eee;
        background: white;
      }
      #event-form div {
        margin-bottom: 10px;
      }
      #tag-checkboxes {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
        gap: 8px;
      }
      .visible {
        display: block !important;
      }
      .btn {
        padding: 8px 16px;
        margin-right: 10px;
        background-color: #f0f0f0;
        border: none;
        cursor: pointer;
      }
      .filters {
        margin-top: 15px;
        margin-bottom: 15px;
      }
      .submit-link {
        text-decoration: none;
        color: black;
        margin-right: 10px;
      }
      .submit-link:hover {
        text-decoration: underline;
      }
    </style>
  </head>
  <body>
    <h1>events | <a href="index.html">tiat.place</a></h1>
    
    <a href="#" id="submit-event" class="submit-link">submit an event</a>
    
    <div class="filters">
      <span>filter: </span>
      <span class="tag active" data-tag="all">all</span>
      <span class="tag" data-tag="generative">generative</span>
      <span class="tag" data-tag="hardware">hardware</span>
      <span class="tag" data-tag="internet">internet</span>
      <span class="tag" data-tag="projection">projection</span>
      <span class="tag" data-tag="installation">installation</span>
      <span class="tag" data-tag="XR">XR</span>
      <span class="tag" data-tag="sound">sound</span>
      <span class="tag" data-tag="AI / ML">AI / ML</span>
      <span class="tag" data-tag="speculative">speculative</span>
      <span class="tag" data-tag="data">data</span>
      <span class="tag" data-tag="fabrication">fabrication</span>
    </div>
    
    <div id="events-container">
      <div class="loading">Loading events...</div>
    </div>

    <!-- Event Submission Form (Hidden by Default) -->
    <div id="submission-form" style="display:none;">
      <h2>Submit an Event</h2>
      <form id="event-form">
        <div>
          <label for="event-name">Event Name:</label>
          <input type="text" id="event-name" required>
        </div>
        <div>
          <label for="event-date">Date:</label>
          <input type="date" id="event-date" required>
        </div>
        <div>
          <label for="event-time">Start Time:</label>
          <input type="time" id="event-time" required>
        </div>
        <div>
          <label for="event-end-time">End Time:</label>
          <input type="time" id="event-end-time" required>
        </div>
        <div>
          <label for="event-location">Location:</label>
          <input type="text" id="event-location" required>
        </div>
        <div>
          <label for="event-url">Event URL:</label>
          <input type="url" id="event-url" placeholder="https://...">
        </div>
        <div>
          <label for="event-description">Description:</label>
          <textarea id="event-description" rows="4" required></textarea>
        </div>
        <div>
          <label for="event-image">Image URL:</label>
          <input type="url" id="event-image">
        </div>
        <div>
          <label>Tags:</label>
          <div id="tag-checkboxes">
            <label><input type="checkbox" name="tags" value="generative"> generative</label>
            <label><input type="checkbox" name="tags" value="hardware"> hardware</label>
            <label><input type="checkbox" name="tags" value="internet"> internet</label>
            <label><input type="checkbox" name="tags" value="projection"> projection</label>
            <label><input type="checkbox" name="tags" value="installation"> installation</label>
            <label><input type="checkbox" name="tags" value="XR"> XR</label>
            <label><input type="checkbox" name="tags" value="sound"> sound</label>
            <label><input type="checkbox" name="tags" value="AI / ML"> AI / ML</label>
            <label><input type="checkbox" name="tags" value="speculative"> speculative</label>
            <label><input type="checkbox" name="tags" value="data"> data</label>
            <label><input type="checkbox" name="tags" value="fabrication"> fabrication</label>
          </div>
        </div>
        <button type="submit" class="btn">Submit Event</button>
        <button type="button" id="cancel-submission" class="btn">Cancel</button>
      </form>
    </div>

    <script>
      // Get DOM elements for form toggle
      const submitButton = document.getElementById('submit-event');
      const submissionForm = document.getElementById('submission-form');
      const cancelButton = document.getElementById('cancel-submission');
      const eventForm = document.getElementById('event-form');
      
      // Toggle submission form display
      submitButton.addEventListener('click', function(e) {
        e.preventDefault();
        submissionForm.style.display = 'block';
      });
      
      cancelButton.addEventListener('click', function() {
        submissionForm.style.display = 'none';
        eventForm.reset();
      });
      
      document.addEventListener('DOMContentLoaded', async () => {
        // Initialize Supabase client
        const supabaseUrl = 'YOUR_SUPABASE_URL';
        const supabaseKey = 'YOUR_SUPABASE_ANON_KEY';
        
        try {
          const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);
          
          // DOM elements
          const eventsContainer = document.getElementById('events-container');
          const tagsContainer = document.querySelector('.filters');
          
          // Initialize
          try {
            await loadAndDisplayEvents();
            setupTagFiltering();
            setupEventForm();
          } catch (error) {
            console.error("Initialization error:", error);
            eventsContainer.innerHTML = `<div class="error">Error initializing: ${error.message}</div>`;
          }
          
          // Functions
          async function loadAndDisplayEvents(filterTag = 'all') {
            // Show loading
            eventsContainer.innerHTML = '<div class="loading">Loading events...</div>';
            
            try {
              // Get current date (starting from today)
              const today = new Date();
              today.setHours(0, 0, 0, 0);
              const todayISO = today.toISOString().split('T')[0];
              
              // Query events from Supabase
              let query = supabase
                .from('events')
                .select('*')
                .gte('date', todayISO)
                .order('date', { ascending: true })
                .order('start_time', { ascending: true });
              
              // Apply tag filter if needed
              if (filterTag !== 'all') {
                query = query.contains('tags', [filterTag]);
              }
              
              const { data: events, error } = await query;
              
              if (error) throw error;
              
              // Clear events container
              eventsContainer.innerHTML = '';
              
              // No events
              if (!events || events.length === 0) {
                eventsContainer.innerHTML = '<p>No upcoming events. Be the first to submit one!</p>';
                return;
              }
              
              // Group events by date
              const eventsByDate = groupEventsByDate(events);
              
              // Create DOM elements for each date and its events
              Object.keys(eventsByDate).forEach(date => {
                // Format date for display
                const dateObj = new Date(date);
                const formattedDate = dateObj.toLocaleDateString('en-US', { 
                  weekday: 'long', 
                  month: 'long', 
                  day: 'numeric' 
                });
                
                // Create date heading
                const dateElement = document.createElement('div');
                dateElement.className = 'date';
                dateElement.textContent = formattedDate;
                eventsContainer.appendChild(dateElement);
                
                // Create event elements
                eventsByDate[date].forEach(event => {
                  // Format times
                  const startTime = formatTime(event.start_time);
                  const endTime = formatTime(event.end_time);
                  
                  // Create event element
                  const eventElement = document.createElement('div');
                  eventElement.className = 'event';
                  eventElement.setAttribute('data-id', event.id);
                  
                  // Star for featured events (keeping this in case you want to add it back later)
                  const featuredStar = event.is_featured ? '★ ' : '';
                  
                  // Event text: time, title, location
                  let eventText = `${featuredStar}${startTime}-${endTime} ${event.name} @ ${event.location}`;
                  
                  // Create event element with URL if available
                  if (event.event_url) {
                    const linkElement = document.createElement('a');
                    linkElement.href = event.event_url;
                    linkElement.textContent = eventText;
                    linkElement.target = "_blank";
                    eventElement.appendChild(linkElement);
                  } else {
                    eventElement.textContent = eventText;
                  }
                  
                  // Create image element (hidden by default)
                  if (event.image_url) {
                    const imageElement = document.createElement('img');
                    imageElement.className = 'event-image';
                    imageElement.src = event.image_url;
                    imageElement.alt = event.name;
                    imageElement.loading = 'lazy'; // Add lazy loading for better performance
                    eventElement.appendChild(imageElement);
                  }
                  
                  // Create description element (hidden by default)
                  const descriptionElement = document.createElement('div');
                  descriptionElement.className = 'event-description';
                  descriptionElement.textContent = event.description;
                  
                  // Add tags to description
                  if (event.tags && event.tags.length > 0) {
                    const tagsText = document.createElement('div');
                    tagsText.textContent = `Tags: ${event.tags.join(', ')}`;
                    descriptionElement.appendChild(tagsText);
                  }
                  
                  eventElement.appendChild(descriptionElement);
                  
                  // Event hover effects
                  eventElement.addEventListener('mouseenter', () => {
                    const image = eventElement.querySelector('.event-image');
                    if (image) image.style.display = 'block';
                    eventElement.querySelector('.event-description').style.display = 'block';
                  });
                  
                  eventElement.addEventListener('mouseleave', () => {
                    const image = eventElement.querySelector('.event-image');
                    if (image) image.style.display = 'none';
                    eventElement.querySelector('.event-description').style.display = 'none';
                  });
                  
                  eventsContainer.appendChild(eventElement);
                });
              });
            } catch (error) {
              console.error('Error loading events:', error);
              eventsContainer.innerHTML = `<div class="error">Error loading events: ${error.message}</div>`;
            }
          }
          
          function setupTagFiltering() {
            const tags = tagsContainer.querySelectorAll('.tag');
            
            tags.forEach(tag => {
              tag.addEventListener('click', () => {
                // Remove active class from all tags
                tags.forEach(t => t.classList.remove('active'));
                
                // Add active class to clicked tag
                tag.classList.add('active');
                
                // Get the tag value and filter events
                const tagValue = tag.getAttribute('data-tag');
                loadAndDisplayEvents(tagValue);
              });
            });
          }
          
          function setupEventForm() {
            eventForm.addEventListener('submit', async (e) => {
              e.preventDefault();
              
              // Get form values
              const name = document.getElementById('event-name').value;
              const date = document.getElementById('event-date').value;
              const startTime = document.getElementById('event-time').value;
              const endTime = document.getElementById('event-end-time').value;
              const location = document.getElementById('event-location').value;
              const description = document.getElementById('event-description').value;
              const imageUrl = document.getElementById('event-image').value;
              const eventUrl = document.getElementById('event-url').value;
              
              // Get selected tags
              const selectedTags = [];
              document.querySelectorAll('input[name="tags"]:checked').forEach(checkbox => {
                selectedTags.push(checkbox.value);
              });
              
              // Create event object
              const newEvent = {
                name,
                date,
                start_time: startTime,
                end_time: endTime,
                location,
                description,
                image_url: imageUrl,
                event_url: eventUrl,
                tags: selectedTags,
                is_featured: false,
                created_at: new Date().toISOString()
              };
              
              try {
                // Save to Supabase
                const { data, error } = await supabase
                  .from('events')
                  .insert([newEvent]);
                
                if (error) throw error;
                
                // Reset form and hide
                eventForm.reset();
                submissionForm.style.display = 'none';
                
                // Reload events
                await loadAndDisplayEvents();
                
                alert('Event submitted successfully!');
              } catch (error) {
                console.error('Error submitting event:', error);
                alert(`Error submitting event: ${error.message}`);
              }
            });
          }
          
          // Helper Functions
          function groupEventsByDate(events) {
            return events.reduce((groups, event) => {
              const date = event.date;
              if (!groups[date]) {
                groups[date] = [];
              }
              groups[date].push(event);
              return groups;
            }, {});
          }
          
          function formatTime(timeString) {
            // Convert 24h format to 12h format
            const [hour, minute] = timeString.split(':');
            const hourNum = parseInt(hour);
            const period = hourNum >= 12 ? 'PM' : 'AM';
            const hour12 = hourNum % 12 || 12;
            return `${hour12}:${minute}${period}`;
          }
        } catch (error) {
          console.error("Error initializing Supabase:", error);
          document.getElementById('events-container').innerHTML = 
            `<div class="error">Error connecting to database: ${error.message}</div>`;
        }
      });
    </script>
  </body>
</html> 